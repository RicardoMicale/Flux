<template>
  <div class="editar-view">
    <div class="busqueda">
      <h3>Buscar materias</h3>
      <form @submit.prevent="buscar()" class="search">
        <div class="barra">
          <label for="nombre">Nombre de la materia</label>
          <input
            type="text"
            name="nombre"
            id="nombre"
            placeholder="Ingresa el nombre de una materia..."
            v-model="nombre"
          />
        </div>
        <input type="submit" value="Buscar" @click="buscar()" />
      </form>
      <div class="resultados">
        <Materia
          class="materia"
          v-for="materia in busqueda"
          :key="materia.codigo"
          :materia="materia"
          :inscrita="false"
        />
      </div>
    </div>
    <section class="inscritas">
      <h3>Asignaturas inscritas</h3>
      <div class="materias-inscritas">
        <Materia
          class="materia"
          v-for="materia in actuales"
          :key="materia.codigo"
          :materia="materia"
          :inscrita="true"
        />
      </div>
    </section>
  </div>
</template>

<script>
import Materia from "../components/Materia.vue";
import firebase from "firebase/compat/app";
import "firebase/compat/auth";
import "firebase/compat/firestore";
import * as fb from "../firebase";

export default {
  name: "Editar",
  components: {
    Materia,
  },
  data() {
    return {
      materias: [],
      busqueda: [],
      nombre: "",
      actuales: [],
      user: {},
    };
  },
  methods: {
    async getMaterias() {
      await fb.getAllMaterias().then((res) => {
        this.materias = [...res];
      });
    },
    buscar() {
      this.busqueda = [];

      this.materias.forEach((materia) => {
        if (materia.nombre.toLowerCase().includes(this.nombre.toLowerCase())) {
          this.busqueda.push(materia);
        }
      });
    },
    async getUser() {
      const userId = firebase.auth().currentUser.uid;

      await fb.getUsuarioDinamico(userId).then((res) => {
        res.onSnapshot((snap) => {
          this.user = snap.data();
          this.actuales = [];
          this.user.trimestreActual.forEach((materia) => {
            fb.getMateria(materia).then((res) => {
              this.actuales.push(res.data());
            });
          });
        });
      });
    },
  },
  beforeMount() {
    this.getMaterias();
    this.getUser();
  },
};
</script>

<style lang="scss" scoped>
@import "../variabes.scss";

.editar-view {
  padding: 3rem;
  display: flex;
  align-items: flex-start;

  h3 {
    color: $font;
    margin-bottom: 2rem;
    font-size: 1.3rem;
  }
}

.search {
  width: 50%;
  display: flex;
  align-items: flex-end;
  justify-content: flex-start;
  margin-bottom: 2rem;

  input {
    padding: 0.5rem 1rem;
    border: none;
    outline: none;
    border-radius: 0.2rem;
    font-family: $fonts;
  }

  input[type="submit"] {
    background-color: $acento;
    color: $font;
    margin-left: 1rem;
    cursor: pointer;

    &:hover {
      background-color: $button-press;
      color: $input-bg-alt;
    }
  }

  .barra {
    display: inherit;
    flex-direction: column;

    label {
      color: $font;
      margin-bottom: 0.5rem;
    }

    input {
      width: 18rem;

      &:focus {
        border: 1px solid $acento;
      }
    }
  }
}

.inscritas {
  margin-left: 10%;
}
</style>